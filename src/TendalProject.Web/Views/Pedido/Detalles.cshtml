@model TendalProject.Common.Utils.PaginaResult<TendalProject.Web.ViewModels.Pedido.DetallePedidoViewModel>
@{
    ViewData["Title"] = "Detalles del Pedido";
    var pedidoId = Context.Request.Query["pedidoId"];
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Detalles del Pedido</h1>
        <a asp-action="Index" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Volver a Pedidos
        </a>
    </div>

    <!-- Información de Paginación -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <p class="mb-0">
                        <strong>Total de Artículos:</strong> @Model.TotalRegistros
                    </p>
                    <p class="mb-0">
                        <strong>Mostrando:</strong> @(Model.Items.Count > 0 ?
                                                $"{((Model.PaginaIndice - 1) * Model.TamanioPagina) + 1} - {Math.Min(Model.PaginaIndice * Model.TamanioPagina, Model.TotalRegistros)}" :
                                                "0") de @Model.TotalRegistros
                    </p>
                </div>
                <div class="col-md-6 text-end">
                    <p class="mb-0">
                        <strong>Página:</strong> @Model.PaginaIndice de @Model.TotalPagias
                    </p>
                </div>
            </div>
        </div>
    </div>

    @if (Model.Items.Any())
    {
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>Artículo</th>
                        <th>Código</th>
                        <th>Categoría</th>
                        <th>Cantidad</th>
                        <th>Precio Unitario</th>
                        <th>Subtotal</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var detalle in Model.Items)
                    {
                        <tr>
                            <td>
                                <div>
                                    <strong>@detalle.NombreArticulo</strong>
                                    @if (!string.IsNullOrEmpty(detalle.DescripcionArticulo))
                                    {
                                        <br />
                                        <small class="text-muted">@detalle.DescripcionArticulo</small>
                                    }
                                </div>
                            </td>
                            <td>@detalle.CodigoArticulo</td>
                            <td>
                                <span class="badge bg-info">@detalle.NombreCategoria</span>
                            </td>
                            <td>
                                <span class="badge bg-primary rounded-pill">@detalle.Cantidad</span>
                            </td>
                            <td>
                                @detalle.PrecioFinal.ToString("C", System.Globalization.CultureInfo.CreateSpecificCulture("es-AR"))
                            </td>
                            <td>
                                <strong>@detalle.SubTotal.ToString("C", System.Globalization.CultureInfo.CreateSpecificCulture("es-AR"))</strong>
                            </td>
                        </tr>
                    }
                </tbody>
                <tfoot>
                    <tr class="table-active">
                        <td colspan="5" class="text-end"><strong>Total del Pedido:</strong></td>
                        <td>
                            <strong>
                                @Model.Items.Sum(x => x.SubTotal).ToString("C", System.Globalization.CultureInfo.CreateSpecificCulture("es-AR"))
                            </strong>
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>

        <!-- Paginación -->
        @if (Model.TotalPagias > 1)
        {
            <nav aria-label="Paginación de detalles del pedido">
                <ul class="pagination justify-content-center">
                    <!-- Botón Anterior -->
                    <li class="page-item @(!Model.TienePaginaAnterior ? "disabled" : "")">
                        @if (Model.TienePaginaAnterior)
                        {
                            <a class="page-link"
                               asp-action="Detalles"
                               asp-route-pedidoId="@pedidoId"
                               asp-route-pagina="@(Model.PaginaIndice - 1)">
                                <i class="bi bi-chevron-left"></i> Anterior
                            </a>
                        }
                        else
                        {
                            <span class="page-link"><i class="bi bi-chevron-left"></i> Anterior</span>
                        }
                    </li>

                    <!-- Números de página -->
                    @{
                        int inicio = Math.Max(1, Model.PaginaIndice - 2);
                        int fin = Math.Min(Model.TotalPagias, Model.PaginaIndice + 2);
                    }

                    @if (inicio > 1)
                    {
                        <li class="page-item">
                            <a class="page-link" asp-action="Detalles" asp-route-pedidoId="@pedidoId" asp-route-pagina="1">1</a>
                        </li>
                        @if (inicio > 2)
                        {
                            <li class="page-item disabled">
                                <span class="page-link">...</span>
                            </li>
                        }
                    }

                    @for (int i = inicio; i <= fin; i++)
                    {
                        <li class="page-item @(i == Model.PaginaIndice ? "active" : "")">
                            <a class="page-link"
                               asp-action="Detalles"
                               asp-route-pedidoId="@pedidoId"
                               asp-route-pagina="@i">@i</a>
                        </li>
                    }

                    @if (fin < Model.TotalPagias)
                    {
                        @if (fin < Model.TotalPagias - 1)
                        {
                            <li class="page-item disabled">
                                <span class="page-link">...</span>
                            </li>
                        }
                        <li class="page-item">
                            <a class="page-link"
                               asp-action="Detalles"
                               asp-route-pedidoId="@pedidoId"
                               asp-route-pagina="@Model.TotalPagias">@Model.TotalPagias</a>
                        </li>
                    }

                    <!-- Botón Siguiente -->
                    <li class="page-item @(!Model.TienePaginaSiguiente ? "disabled" : "")">
                        @if (Model.TienePaginaSiguiente)
                        {
                            <a class="page-link"
                               asp-action="Detalles"
                               asp-route-pedidoId="@pedidoId"
                               asp-route-pagina="@(Model.PaginaIndice + 1)">
                                Siguiente <i class="bi bi-chevron-right"></i>
                            </a>
                        }
                        else
                        {
                            <span class="page-link">Siguiente <i class="bi bi-chevron-right"></i></span>
                        }
                    </li>
                </ul>
            </nav>
        }
    }
    else
    {
        <div class="alert alert-info text-center">
            <i class="bi bi-info-circle me-2"></i>
            No se encontraron detalles para este pedido.
        </div>
    }

    <!-- Información adicional si es necesario -->
    <div class="mt-4">
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Resumen</h5>
                    </div>
                    <div class="card-body">
                        <p><strong>Total de artículos:</strong> @Model.TotalRegistros</p>
                        <p><strong>Total de páginas:</strong> @Model.TotalPagias</p>
                        <p><strong>Tamaño de página:</strong> @Model.TamanioPagina</p>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Acciones</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a href="#" class="btn btn-outline-primary">
                                <i class="bi bi-printer"></i> Imprimir Detalles
                            </a>
                            <a href="#" class="btn btn-outline-success">
                                <i class="bi bi-file-excel"></i> Exportar a Excel
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Estilos adicionales -->
<style>
    .table th {
        background-color: #343a40;
        color: white;
    }

    .badge {
        font-size: 0.9em;
    }

    .page-item.active .page-link {
        background-color: #0d6efd;
        border-color: #0d6efd;
    }

    .card {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    }
</style>